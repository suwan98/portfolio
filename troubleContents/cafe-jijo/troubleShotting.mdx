---
title: Jijo Cafe 프로젝트 트러블 슈팅
category: cafe-jijo
---

# 🏊‍♂️ 트러블 슈팅

## 1. zustand를 통한 로그인/회원가입 상태 구현

### 문제점

- 회원가입이나, 로그인, 로그아웃은 PB SDK를 사용하여 `useAuthStore`의 메서드로 구성을 했었다
- 여기서 생각하기에 새로 업데이트 되거나 / 혹은 데이터 내에 있던 기존 유저정보를 `store`내 업데이트 된 `initalAuthState`에 담아야하는데 그 방법을 어떻게 구현해야까?

**현재까지 구성한 코드**

```jsx
import pb from "@/api/pocketbase";
import {create} from "zustand";

const initalAuthState = {
  isAuth: false,
  user: null,
  token: "",
};

const useAuthStore = create((set) => ({
  ...initalAuthState,

  /* Pb SDK를 사용한 회원가입 */
  signUp: async (registerUser) => {
    return await pb.collection("users").create(registerUser);
  },

  /* Pb SDK를 사용한 로그인 */
  signIn: async (userNameOrEmail, password) => {
    return await pb
      .collection("users")
      .authWithPassword(userNameOrEmail, password);
    // db에 있는 유효한 로그인 정보일시 해당 정보를 set을 통해 담아야 할 것같은데 어떻게 담아야할지 모르겠습니다🥹
  },

  /* Pb SDK를 사용한 로그아웃 */
  signOut: async () => {
    return await pb.authStore.clear();
  },

  /* Pb SDK를 사용한 회원탈퇴 */
  Withdrawal: async (recordId) => {
    return await pb.collection("users").delete(recordId);
  },
}));

export default useAuthStore;
```

### 해결 : 응답받은 결과를 바로 내보내지 않고, Zustand의 set() 함수를 사용해 앱 상태를 업데이트하자!

**store/auth.js**

```tsx
import pb from "@/api/pocketbase";
import {create} from "zustand";
import {devtools} from "zustand/middleware";

const USER_COLLECTION = "users";

const initialAuthState = {
  isAuth: false,
  user: null,
  token: "",
};

const authStore = (set) => ({
  ...initialAuthState,

  /* Pb SDK를 사용한 회원가입 */
  signUp: async (registerUser) => {
    return await pb.collection(USER_COLLECTION).create(registerUser);
  },

  /* Pb SDK를 사용한 로그인 */
  signIn: async (userNameOrEmail, password) => {
    const authData = await pb
      .collection(USER_COLLECTION)
      .authWithPassword(userNameOrEmail, password);

    const {isValid, model, token} = pb.authStore;

    set(
      (state) => ({
        ...state,
        isAuth: isValid,
        user: model,
        token,
      }),
      false,
      "auth/singin"
    );

    return authData;
  },

  /* Pb SDK를 사용한 로그아웃 */
  signOut: async () => {
    const response = await pb.authStore.clear();

    set(
      (state) => ({
        ...state,
        ...initialAuthState,
      }),
      false,
      "auth/singout"
    );

    return response;
  },

  /* Pb SDK를 사용한 회원탈퇴 */
  withDrawal: async (recordId) => {
    const response = await pb.collection(USER_COLLECTION).delete(recordId);

    set(
      (state) => ({
        ...state,
        ...initialAuthState,
      }),
      false,
      "auth/withDrawal"
    );

    return response;
  },
});

const useAuthStore = create(devtools(authStore));

export default useAuthStore;
```

로그인 페이지 컴포넌트에서 사용은??

```tsx
import useAuthStore from '@/store/auth';
// ...

function SignIn() {
  const isAuth = useAuthStore((state) => state.isAuth);
  const signIn = useAuthStore((state) => state.signIn);

  const [formState, setFormState] = useState({
    email: '',
    password: '',
  });

  const handleSignIn = async (e) => {
    e.preventDefault();

    const { email, password } = formState;

    try {
      await signIn(email, password);
			// ...
    } catch (error) {
      console.error(error);
    }
  };

	// ...

  return (...);
}
```
